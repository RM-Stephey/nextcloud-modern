; PHP OPcache configuration for Nextcloud
; This file optimizes OPcache settings for better performance

; Enable OPcache
opcache.enable=1
opcache.enable_cli=1

; Memory consumption - Increased from default 128MB to 512MB
; This should be sufficient for Nextcloud with many apps
opcache.memory_consumption=512

; The amount of memory for interned strings in Mbytes
opcache.interned_strings_buffer=16

; The maximum number of keys (scripts) in the OPcache hash table
; Nextcloud can have many PHP files, especially with apps
opcache.max_accelerated_files=10000

; How often to check file timestamps for changes to the shared memory storage allocation
; 0 means it will check on every request (good for development)
; For production, set to 60 or higher
opcache.revalidate_freq=60

; If enabled, a fast shutdown sequence is used for the accelerated code
opcache.fast_shutdown=1

; Allow file existence override (file_exists, etc.) performance feature
opcache.enable_file_override=1

; Optimization level - maximum optimization
opcache.optimization_level=0x7FFFBFFF

; Save comments in op-code (required for some Nextcloud apps)
opcache.save_comments=1

; Load comments (required for annotations in some apps)
opcache.load_comments=1

; Maximum file size that will be cached (in bytes)
; 0 means no limit
opcache.max_file_size=0

; Validate timestamps using the opcache.revalidate_freq setting
opcache.validate_timestamps=1

; Maximum wasted memory percentage before restart
opcache.max_wasted_percentage=10

; Size of the shared memory storage used by JIT in megabytes
; JIT is available in PHP 8.0+
opcache.jit_buffer_size=128M

; JIT mode - tracing JIT is generally best for web applications
opcache.jit=tracing

; For Nextcloud, we want to ensure consistency
opcache.consistency_checks=0

; Blacklist file - useful if certain files cause issues
; opcache.blacklist_filename=/etc/php/opcache-blacklist.txt

; Error log for OPcache
; opcache.error_log=/var/log/php-opcache-error.log

; Log verbosity level
opcache.log_verbosity_level=1
